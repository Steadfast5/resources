!function(){function t(e,r){return r?require(e):e.slice?t[n(e)]:function(r,o){e(r={exports:{}}),t[n(o)]=r.exports};function n(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var e=module;t(function(t){"undefined"!=typeof window&&(t.window=window);var r=(t.window||t).SEA||{};(r.window=t.window)&&(r.window.SEA=r);try{void 0+""!=typeof e&&(e.exports=r)}catch(t){}t.exports=r})(t,"./root"),t(function(e){var r=t("./root");try{r.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch(t){}})(t,"./https"),t(function(e){var r;if(r+""==typeof btoa){if(r+""==typeof Buffer)try{global.Buffer=t("buffer",1).Buffer}catch(t){console.log("Please `npm install buffer` or add it to your package.json !")}global.btoa=function(t){return Buffer.from(t,"binary").toString("base64")},global.atob=function(t){return Buffer.from(t,"base64").toString("binary")}}})(t,"./base64"),t(function(e){function r(){}t("./base64"),Object.assign(r,{from:Array.from}),r.prototype=Object.create(Array.prototype),r.prototype.toString=function(t,e,r){t=t||"utf8",e=e||0;const n=this.length;if("hex"===t){const t=new Uint8Array(this);return[...Array((r&&r+1||n)-e).keys()].map(r=>t[r+e].toString(16).padStart(2,"0")).join("")}return"utf8"===t?Array.from({length:(r||n)-e},(t,r)=>String.fromCharCode(this[r+e])).join(""):"base64"===t?btoa(this):void 0},e.exports=r})(t,"./array"),t(function(e){t("./base64");var r=t("./array");function n(...t){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),n.from(...t)}n.prototype=Object.create(Array.prototype),Object.assign(n,{from(){if(!Object.keys(arguments).length||null==arguments[0])throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const t=arguments[0];let e;if("string"==typeof t){const n=arguments[1]||"utf8";if("hex"===n){const n=t.match(/([\da-fA-F]{2})/g).map(t=>parseInt(t,16));if(!n||!n.length)throw new TypeError("Invalid first argument for type 'hex'.");e=r.from(n)}else if("utf8"===n||"binary"===n){const n=t.length,o=new Uint16Array(n);Array.from({length:n},(e,r)=>o[r]=t.charCodeAt(r)),e=r.from(o)}else if("base64"===n){const n=atob(t),o=n.length,a=new Uint8Array(o);Array.from({length:o},(t,e)=>a[e]=n.charCodeAt(e)),e=r.from(a)}else"binary"===n?e=r.from(t):console.info("SafeBuffer.from unknown encoding: "+n);return e}t.byteLength;if(t.byteLength?t.byteLength:t.length){let e;return t instanceof ArrayBuffer&&(e=new Uint8Array(t)),r.from(e||t)}},alloc:(t,e=0)=>r.from(new Uint8Array(Array.from({length:t},()=>e))),allocUnsafe:t=>r.from(new Uint8Array(Array.from({length:t}))),concat(t){if(!Array.isArray(t))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return r.from(t.reduce((t,e)=>t.concat(Array.from(e)),[]))}}),n.prototype.from=n.from,n.prototype.toString=r.prototype.toString,e.exports=n})(t,"./buffer"),t(function(r){const n=t("./root"),o={Buffer:t("./buffer")};var a={};if(JSON.parseAsync=JSON.parseAsync||function(t,e,r){try{e(void 0,JSON.parse(t,r))}catch(t){e(t)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,e,r,n){try{e(void 0,JSON.stringify(t,r,n))}catch(t){e(t)}},o.parse=function(t,e){return new Promise(function(r,n){JSON.parseAsync(t,function(t,e){t?n(t):r(e)},e)})},o.stringify=function(t,e,r){return new Promise(function(n,o){JSON.stringifyAsync(t,function(t,e){t?o(t):n(e)},e,r)})},n.window&&(o.crypto=window.crypto||window.msCrypto,o.subtle=(o.crypto||a).subtle||(o.crypto||a).webkitSubtle,o.TextEncoder=window.TextEncoder,o.TextDecoder=window.TextDecoder,o.random=(t=>o.Buffer.from(o.crypto.getRandomValues(new Uint8Array(o.Buffer.alloc(t)))))),!o.TextDecoder){const{TextEncoder:r,TextDecoder:n}=t((void 0+""==typeof e?".":"")+"./lib/text-encoding",1);o.TextDecoder=n,o.TextEncoder=r}if(!o.crypto)try{var i=t("crypto",1);Object.assign(o,{crypto:i,random:t=>o.Buffer.from(i.randomBytes(t))});const{Crypto:e}=t("@peculiar/webcrypto",1);o.ossl=o.subtle=new e({directory:"ossl"}).subtle}catch(t){console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}r.exports=o})(t,"./shim"),t(function(e){var r=t("./root"),n=t("./shim"),o={pbkdf2:{hash:{name:"SHA-256"},iter:1e5,ks:64},ecdsa:{pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},ecdh:{name:"ECDH",namedCurve:"P-256"},jwk:function(t,e){var r={kty:"EC",crv:"P-256",x:(t=t.split("."))[0],y:t[1],ext:!0};return r.key_ops=e?["sign"]:["verify"],e&&(r.d=e),r},keyToJwk:function(t){return{kty:"oct",k:t.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},recall:{validity:43200,hook:function(t){return t}},check:function(t){return"string"==typeof t&&"SEA{"===t.slice(0,4)},parse:async function(t){try{var e="string"==typeof t;return e&&"SEA{"===t.slice(0,4)&&(t=t.slice(3)),e?await n.parse(t):t}catch(t){}return t}};r.opt=o,e.exports=o})(t,"./settings"),t(function(e){var r=t("./shim");e.exports=async function(t,e){var n="string"==typeof t?t:await r.stringify(t),o=await r.subtle.digest({name:e||"SHA-256"},(new r.TextEncoder).encode(n));return r.Buffer.from(o)}})(t,"./sha256"),t(function(e){const r=t("./shim"),n=r.subtle,o=r.ossl?r.ossl:n;e.exports=(t=>o.digest({name:"SHA-1"},new ArrayBuffer(t)))})(t,"./sha1"),t(function(e){var r=t("./root"),n=t("./shim"),o=t("./settings"),a=t("./sha256");r.work=r.work||(async(t,e,i,s)=>{try{var c=(e||{}).epub||e;if(s=s||{},c instanceof Function&&(i=c,c=void 0),t="string"==typeof t?t:await n.stringify(t),"sha"===(s.name||"").toLowerCase().slice(0,3)){var u=n.Buffer.from(await a(t,s.name),"binary").toString(s.encode||"base64");if(i)try{i(u)}catch(t){console.log(t)}return u}c=c||n.random(9);var f=await(n.ossl||n.subtle).importKey("raw",(new n.TextEncoder).encode(t),{name:s.name||"PBKDF2"},!1,["deriveBits"]),p=await(n.ossl||n.subtle).deriveBits({name:s.name||"PBKDF2",iterations:s.iterations||o.pbkdf2.iter,salt:(new n.TextEncoder).encode(s.salt||c),hash:s.hash||o.pbkdf2.hash},f,s.length||8*o.pbkdf2.ks);t=n.random(t.length);var l=n.Buffer.from(p,"binary").toString(s.encode||"base64");if(i)try{i(l)}catch(t){console.log(t)}return l}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(i&&i())}}),e.exports=r.work})(t,"./work"),t(function(e){var r=t("./root"),n=t("./shim");t("./settings");r.name=r.name||(async(t,e)=>{try{if(t)try{t()}catch(t){console.log(t)}return}catch(e){if(console.log(e),r.err=e,r.throw)throw e;return void(t&&t())}}),r.pair=r.pair||(async(t,e)=>{try{var o=n.ossl||n.subtle,a=await n.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async t=>{var e={};e.priv=(await n.subtle.exportKey("jwk",t.privateKey)).d;var r=await n.subtle.exportKey("jwk",t.publicKey);return e.pub=r.x+"."+r.y,e});try{var i=await o.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async t=>{var e={};e.epriv=(await o.exportKey("jwk",t.privateKey)).d;var r=await o.exportKey("jwk",t.publicKey);return e.epub=r.x+"."+r.y,e})}catch(t){if(r.window)throw t;if("Error: ECDH is not a supported algorithm"!=t)throw t;console.log("Ignoring ECDH...")}i=i||{};var s={pub:a.pub,priv:a.priv,epub:i.epub,epriv:i.epriv};if(t)try{t(s)}catch(t){console.log(t)}return s}catch(e){if(console.log(e),r.err=e,r.throw)throw e;return void(t&&t())}}),e.exports=r.pair})(t,"./pair"),t(function(e){var r,n=t("./root"),o=t("./shim"),a=t("./settings"),i=t("./sha256");n.sign=n.sign||(async(t,e,s,c)=>{try{if(c=c||{},!(e||c).priv){if(!n.I)throw"No signing key.";e=await n.I(null,{what:t,how:"sign",why:c.why})}if(r===t)throw"`undefined` not allowed.";var u=await a.parse(t),f=c.check=c.check||u;if(n.verify&&(n.opt.check(f)||f&&f.s&&f.m)&&r!==await n.verify(f,e)){var p=await a.parse(f);if(c.raw||(p="SEA"+await o.stringify(p)),s)try{s(p)}catch(t){console.log(t)}return p}var l=e.pub,y=e.priv,h=a.jwk(l,y),g=await i(u),w=await(o.ossl||o.subtle).importKey("jwk",h,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(t=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new Uint8Array(g)));p={m:u,s:o.Buffer.from(w,"binary").toString(c.encode||"base64")};if(c.raw||(p="SEA"+await o.stringify(p)),s)try{s(p)}catch(t){console.log(t)}return p}catch(t){if(console.log(t),n.err=t,n.throw)throw t;return void(s&&s())}}),e.exports=n.sign})(t,"./sign"),t(function(e){var r,n=t("./root"),o=t("./shim"),a=t("./settings"),i=t("./sha256");n.verify=n.verify||(async(t,e,s,c)=>{try{var u=await a.parse(t);if(!1===e){var f=await a.parse(u.m);if(s)try{s(f)}catch(t){console.log(t)}return f}c=c||{};var p,l,y,h=e.pub||e,g=n.opt.slow_leak?await n.opt.slow_leak(h):await(o.ossl||o.subtle).importKey("jwk",a.jwk(h),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),w=await i(u.m);try{if(p=o.Buffer.from(u.s,c.encode||"base64"),l=new Uint8Array(p),!(y=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,l,new Uint8Array(w))))throw"Signature did not match."}catch(r){if(n.opt.fallback)return await n.opt.fall_verify(t,e,s,c)}var d=y?await a.parse(u.m):r;if(s)try{s(d)}catch(t){console.log(t)}return d}catch(t){if(console.log(t),n.err=t,n.throw)throw t;return void(s&&s())}}),e.exports=n.verify;var s={},c=(n.opt.slow_leak=(t=>{if(s[t])return s[t];var e=a.jwk(t);return s[t]=(o.ossl||o.subtle).importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),s[t]}),n.opt);n.opt.fall_verify=async function(t,e,s,u,f){if(f===n.opt.fallback)throw"Signature did not match";f=f||1;var p=t||"";t=n.opt.unpack(t)||t;var l,y,h,g=await a.parse(t),w=e.pub||e,d=await n.opt.slow_leak(w),b=f<=n.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},(new o.TextEncoder).encode(await a.parse(g.m)))):await i(g.m);try{if(l=o.Buffer.from(g.s,u.encode||"base64"),y=new Uint8Array(l),!(h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,y,new Uint8Array(b))))throw"Signature did not match."}catch(t){try{l=o.Buffer.from(g.s,"utf8"),y=new Uint8Array(l),h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,y,new Uint8Array(b))}catch(t){if(!h)throw"Signature did not match."}}var v=h?await a.parse(g.m):r;if(c.fall_soul=p["#"],c.fall_key=p["."],c.fall_val=t,c.fall_state=p[">"],s)try{s(v)}catch(t){console.log(t)}return v},n.opt.fallback=2})(t,"./verify"),t(function(e){var r=t("./shim"),n=t("./settings"),o=t("./sha256");e.exports=(async(t,e,a)=>{a=a||{};const i=t+(e||r.random(8)).toString("utf8"),s=r.Buffer.from(await o(i),"binary"),c=n.keyToJwk(s);return await r.subtle.importKey("jwk",c,{name:"AES-GCM"},!1,["encrypt","decrypt"])})})(t,"./aeskey"),t(function(e){var r=t("./root"),n=t("./shim"),o=(t("./settings"),t("./aeskey"));r.encrypt=r.encrypt||(async(t,e,a,i)=>{try{i=i||{};var s=(e||i).epriv||e;if(void 0===t)throw"`undefined` not allowed.";if(!s){if(!r.I)throw"No encryption key.";s=(e=await r.I(null,{what:t,how:"encrypt",why:i.why})).epriv||e}var c="string"==typeof t?t:await n.stringify(t),u={s:n.random(9),iv:n.random(15)},f=await o(s,u.s,i).then(t=>n.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(u.iv)},t,(new n.TextEncoder).encode(c))),p={ct:n.Buffer.from(f,"binary").toString(i.encode||"base64"),iv:u.iv.toString(i.encode||"base64"),s:u.s.toString(i.encode||"base64")};if(i.raw||(p="SEA"+await n.stringify(p)),a)try{a(p)}catch(t){console.log(t)}return p}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(a&&a())}}),e.exports=r.encrypt})(t,"./encrypt"),t(function(e){var r=t("./root"),n=t("./shim"),o=t("./settings"),a=t("./aeskey");r.decrypt=r.decrypt||(async(t,e,i,s)=>{try{s=s||{};var c=(e||s).epriv||e;if(!c){if(!r.I)throw"No decryption key.";c=(e=await r.I(null,{what:t,how:"decrypt",why:s.why})).epriv||e}var u,f,p,l=await o.parse(t);try{u=n.Buffer.from(l.s,s.encode||"base64"),f=n.Buffer.from(l.iv,s.encode||"base64"),p=n.Buffer.from(l.ct,s.encode||"base64");var y=await a(c,u,s).then(t=>n.subtle.decrypt({name:s.name||"AES-GCM",iv:new Uint8Array(f),tagLength:128},t,new Uint8Array(p)))}catch(n){if("utf8"===s.encode)throw"Could not decrypt";if(r.opt.fallback)return s.encode="utf8",await r.decrypt(t,e,i,s)}var h=await o.parse(new n.TextDecoder("utf8").decode(y));if(i)try{i(h)}catch(t){console.log(t)}return h}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(i&&i())}}),e.exports=r.decrypt})(t,"./decrypt"),t(function(e){var r=t("./root"),n=t("./shim");t("./settings");r.secret=r.secret||(async(t,e,a,i)=>{try{if(i=i||{},!e||!e.epriv||!e.epub){if(!r.I)throw"No secret mix.";e=await r.I(null,{what:t,how:"secret",why:i.why})}var s=t.epub||t,c=e.epub,u=e.epriv,f=n.ossl||n.subtle,p=o(s),l=Object.assign({public:await f.importKey(...p,!0,[])},{name:"ECDH",namedCurve:"P-256"}),y=o(c,u),h=await f.importKey(...y,!1,["deriveBits"]).then(async t=>{var e=await f.deriveBits(l,t,256),r=new Uint8Array(e),n=await f.importKey("raw",r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return f.exportKey("jwk",n).then(({k:t})=>t)});if(a)try{a(h)}catch(t){console.log(t)}return h}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(a&&a())}});var o=(t,e)=>{var[r,n]=t.split("."),o=e?{d:e}:{};return["jwk",Object.assign(o,{x:r,y:n,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};e.exports=r.secret})(t,"./secret"),t(function(e){var r=t("./root");r.certify=r.certify||(async(t,e={},n,o,a={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),!(t=(()=>{var e=[];if(t){if(("string"==typeof t||Array.isArray(t))&&t.indexOf("*")>-1)return"*";if("string"==typeof t)return t;if(Array.isArray(t)){if(1===t.length&&t[0])return"object"==typeof t[0]&&t[0].pub?t[0].pub:"string"==typeof t[0]?t[0]:null;t.map(t=>{"string"==typeof t?e.push(t):"object"==typeof t&&t.pub&&e.push(t.pub)})}return"object"==typeof t&&t.pub?t.pub:e.length>0?e:null}})()))return console.log("No certificant found.");const s=!a.expiry||"number"!=typeof a.expiry&&"string"!=typeof a.expiry?null:parseFloat(a.expiry),c=(e||{}).read?e.read:null,u=(e||{}).write?e.write:"string"==typeof e||Array.isArray(e)||e["+"]||e["#"]||e["."]||e["="]||e["*"]||e[">"]||e["<"]?e:null,f=(a||{}).block||(a||{}).blacklist||(a||{}).ban||{},p=f.read&&("string"==typeof f.read||(f.read||{})["#"])?f.read:null,l="string"==typeof f?f:f.write&&("string"==typeof f.write||f.write["#"])?f.write:null;if(!c&&!u)return console.log("No policy found.");const y=JSON.stringify({c:t,...s?{e:s}:{},...c?{r:c}:{},...u?{w:u}:{},...p?{rb:p}:{},...l?{wb:l}:{}});var i=await r.sign(y,n,null,{raw:1});if(a.raw||(i="SEA"+JSON.stringify(i)),o)try{o(i)}catch(t){console.log(t)}return i}catch(t){if(r.err=t,r.throw)throw t;return void(o&&o())}}),e.exports=r.certify})(t,"./certify"),t(function(e){var r=t("./shim"),n=t("./root");n.work=t("./work"),n.sign=t("./sign"),n.verify=t("./verify"),n.encrypt=t("./encrypt"),n.decrypt=t("./decrypt"),n.certify=t("./certify"),n.random=n.random||r.random,n.Buffer=n.Buffer||t("./buffer"),n.keyid=n.keyid||(async t=>{try{const e=r.Buffer.concat(t.replace(/-/g,"+").replace(/_/g,"/").split(".").map(t=>r.Buffer.from(t,"base64"))),n=r.Buffer.concat([r.Buffer.from([153,e.length/256,e.length%256]),e]),o=await sha1hash(n),a=r.Buffer.from(o,"binary");return a.toString("hex",a.length-8)}catch(t){throw console.log(t),t}}),((n.window||{}).GUN||{}).SEA=n,e.exports=n})(t,"./sea"),t(function(r){var n,o=t("./sea");function a(t){this._={$:this}}function i(){return n.state().toString(36).replace(".","")}n=o.window?o.window.GUN||{chain:{}}:t((void 0+""==typeof e?".":"")+"./gun",1),o.GUN=n,a.prototype=function(){function t(){}return t.prototype=n.chain,new t}(),a.prototype.constructor=a,n.chain.user=function(t){var e,r=this.back(-1);if(t)return t=o.opt.pub((t._||"")["#"])||t,r.get("~"+t);if(e=r.back("user"))return e;var n=r=r._,s=n.opt.uuid||i;return(n=(e=n.user=this.chain(new a))._).opt={},n.opt.uuid=function(t){var e=s(),n=r.user;return n&&(n=n.is)&&(n=n.pub)?(e="~"+n+"/"+e,t&&t.call&&t(null,e),e):e},e},n.User=a,a.GUN=n,a.SEA=n.SEA=o,r.exports=a})(t,"./user"),t(function(r){var n;(""+n!=typeof window?window.Gun||{chain:{}}:t((""+n==typeof e?".":"")+"./gun",1)).chain.then=function(t,e){var r=this,n=new Promise(function(t,n){r.once(t,e)});return t?n.then(t):n}})(t,"./then"),t(function(e){var r=t("./user"),n=r.SEA,o=r.GUN,a=function(){};r.prototype.create=function(...t){var e,r="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,i=r&&(r.pub||r.epub)?r.pub:"string"==typeof t[0]?t[0]:null,s=r&&(r.pub||r.epub)?r:i&&"string"==typeof t[1]?t[1]:null,c=t.filter(t=>"function"==typeof t)[0]||null,u=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{},f=this,p=f._,l=f.back(-1);if((c=c||a,!1!==(u=u||{}).check)&&(i||(e="No user."),(s||"").length<8&&(e="Password too short!"),e))return c({err:o.log(e)}),f;if(p.ing)return(c||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),f;p.ing=!0;var y={};return y.a=function(t){if(y.pubs=t,t&&!u.already){var e={err:o.log("User already created!")};return p.ing=!1,(c||a)(e),void f.leave()}y.salt=String.random(64),n.work(s,y.salt,y.b)},y.b=function(t){y.proof=t,r?y.c(r):n.pair(y.c)},y.c=function(t){var e;y.pair=t||{},(e=p.root.user)&&(e._.sea=t,e.is={pub:t.pub,epub:t.epub,alias:i}),y.data={pub:t.pub},y.d()},y.d=function(){y.data.alias=i,y.e()},y.e=function(){y.data.epub=y.pair.epub,n.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},y.proof,y.f,{raw:1})},y.f=function(t){y.data.auth=JSON.stringify({ek:t,s:y.salt}),y.g(y.data.auth)},y.g=function(t){var e;y.data.auth=y.data.auth||t,l.get(e="~"+y.pair.pub).put(y.data).on(y.h);var r={};r[e]={"#":e},l.get("~@"+i).put(r).get(e).on(y.i)},y.h=function(t,e,r,n){n.off(),y.h.ok=1,y.i()},y.i=function(t,e,n,o){o&&(y.i.ok=1,o.off()),y.h.ok&&y.i.ok&&(p.ing=!1,c({ok:0,pub:y.pair.pub}),a===c&&(r?f.auth(r):f.auth(i,s)))},l.get("~@"+i).once(y.a),f},r.prototype.leave=function(t,e){var r=this.back(-1)._.user;if(r&&(delete r.is,delete r._.is,delete r._.sea),n.window)try{var o={};delete(o=window.sessionStorage).recall,delete o.pair}catch(t){}return this}})(t,"./create"),t(function(e){var r=t("./user"),n=r.SEA,o=r.GUN,a=function(){};function i(t){if("string"!=typeof t)return t;try{t=JSON.parse(t)}catch(e){t={}}return t}r.prototype.auth=function(...t){var e="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,r=e||"string"!=typeof t[0]?null:t[0],s=r&&"string"==typeof t[1]?t[1]:null,c=t.filter(t=>"function"==typeof t)[0]||null,u=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{},f=this,p=f._,l=f.back(-1);if(p.ing)return(c||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),f;p.ing=!0;var y,h={};return h.a=function(t){if(!t)return h.b();if(!t.pub){var e=[];return Object.keys(t).forEach(function(r){"_"!=r&&e.push(t[r])}),h.b(e)}if(h.name)return h.f(t);h.c((h.data=t).auth)},h.b=function(t){var e=(h.list=(h.list||[]).concat(t||[])).shift();if(y===e)return h.name?h.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer."):h.err("Wrong user or password.");l.get(e).once(h.a)},h.c=function(t){return y===t?h.b():"string"==typeof t?h.c(i(t)):void n.work(s,(h.auth=t).s,h.d,h.enc)},h.d=function(t){n.decrypt(h.auth.ek,t,h.e,h.enc)},h.e=function(t){if(y===t)return h.enc?(h.enc=null,h.b()):(h.enc={encode:"utf8"},h.c(h.auth));h.half=t,h.f(h.data)},h.f=function(t){var e=h.half||{},r=h.data||{};h.g(h.lol={pub:t.pub||r.pub,epub:t.epub||r.epub,priv:t.priv||e.priv,epriv:t.epriv||e.epriv})},h.g=function(t){if(!t||!t.pub||!t.epub)return h.b();h.pair=t;var e=l._.user,g=e._,w=(g.tag,g.opt);(g=e._=l.get("~"+t.pub)._).opt=w,e.is={pub:t.pub,epub:t.epub,alias:r||t.pub},g.sea=h.pair,p.ing=!1;try{s&&y==(i(p.root.graph["~"+t.pub].auth)||"")[":"]&&(u.shuffle=u.change=s)}catch(t){}if(u.change?h.z():(c||a)(g),n.window&&(f.back("user")._.opt||u).remember)try{var d={};(d=window.sessionStorage).recall=!0,d.pair=JSON.stringify(t)}catch(t){}try{l._.tag.auth?l._.on("auth",g):setTimeout(function(){l._.on("auth",g)},1)}catch(t){o.log("Your 'auth' callback crashed with:",t)}},h.z=function(){h.salt=String.random(64),n.work(u.change,h.salt,h.y)},h.y=function(t){n.encrypt({priv:h.pair.priv,epriv:h.pair.epriv},t,h.x,{raw:1})},h.x=function(t){h.w(JSON.stringify({ek:t,s:h.salt}))},h.w=function(t){if(u.shuffle){console.log("migrate core account from UTF8 & shuffle");var e={};Object.keys(h.data).forEach(function(t){e[t]=h.data[t]}),delete e._,e.auth=t,l.get("~"+h.pair.pub).put(e)}l.get("~"+h.pair.pub).get("auth").put(t,c||a)},h.err=function(t){var e={err:o.log(t||"User cannot be found!")};p.ing=!1,(c||a)(e)},h.plugin=function(t){if(!(h.name=t))return h.err();var e=[t];"~"!==t[0]&&(e[1]="~"+t,e[2]="~@"+t),h.b(e)},e?h.g(e):r?l.get("~@"+r).once(h.a):r||s||n.name(h.plugin),f}})(t,"./auth"),t(function(e){var r=t("./user"),n=r.SEA;r.GUN;r.prototype.recall=function(t,e){var r=this.back(-1);if((t=t||{})&&t.sessionStorage){if(n.window)try{var o;(o=window.sessionStorage)&&(r._.opt.remember=!0,(this.back("user")._.opt||t).remember=!0,(o.recall||o.pair)&&r.user().auth(JSON.parse(o.pair),e))}catch(t){}return this}return this}})(t,"./recall"),t(function(e){var r=t("./user"),n=r.SEA,o=r.GUN;r.prototype.pair=function(){var t,e=this;try{t=new Proxy({DANGER:"☠"},{get:function(t,r,n){if(e.is&&(e._||"").sea)return e._.sea[r]}})}catch(t){}return t},r.prototype.delete=async function(t,e,r){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");this.back(-1);var n=this.back("user");try{n.auth(t,e,function(t){(n.is||{}).pub;n.map().once(function(){this.put(null)}),n.leave(),(r||function(){})({ok:0})})}catch(t){o.log("User.delete failed! Error:",t)}return this},r.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const t=this.back(-1);try{return await authRecall(t),t._.user._}catch(t){const e="No session!";throw o.log(e),{err:e}}},r.prototype.trust=async function(t){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),o.is(t)&&t.get("pub").get((t,e)=>{console.log(t,e)}),t.get("trust").get(path).put(theirPubkey)},r.prototype.grant=function(t,e){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var r=this.back(-1).user(),o=r._.sea,a="";return this.back(function(t){t.is||(a+=t.get||"")}),async function(){var i,s=await r.get("grant").get(o.pub).get(a).then();(s=await n.decrypt(s,o))||(s=n.random(16).toString(),i=await n.encrypt(s,o),r.get("grant").get(o.pub).get(a).put(i));var c=t.get("pub").then(),u=t.get("epub").then();c=await c,u=await u;var f=await n.secret(u,o);i=await n.encrypt(s,f),r.get("grant").get(c).get(a).put(i,e)}(),this},r.prototype.secret=function(t,e){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var r=this,o=r.back(-1).user(),a=o.pair(),i="";return r.back(function(t){t.is||(i+=t.get||"")}),async function(){var s,c=await o.get("trust").get(a.pub).get(i).then();(c=await n.decrypt(c,a))||(c=n.random(16).toString(),s=await n.encrypt(c,a),o.get("trust").get(a.pub).get(i).put(s)),s=await n.encrypt(t,c),r.put(s,e)}(),r},e.exports=r})(t,"./share"),t(function(r){var n,o=t("./sea"),a=t("./settings"),i=""+n!=typeof window?window.Gun||{on:function(){}}:t((""+n==typeof e?".":"")+"./gun",1);function s(t){var e,r=this,n=r.as,a=t.put,c=a["#"],u=a["."],f=a[":"],p=a[">"],l=t["#"];if(c&&u)if((t._||"").faith&&(n.opt||"").faith&&"function"==typeof t._)o.opt.pack(a,function(e){o.verify(e,!1,function(e){a["="]=o.opt.unpack(e),r.to.next(t)})});else{var y=function(e){n.on("in",{"@":l,err:t.err=e})};(t._||"").DBG&&((t._||"").DBG.c=+new Date),0<=c.indexOf("<?")&&(e=parseFloat(c.split("<?")[1]||""))&&p<i.state()-1e3*e?(e=t._)&&e.stun&&e.stun--:"~@"!==c?"~@"!==c.slice(0,2)?(e=o.opt.pub(c))?s.pub(r,t,f,u,c,n,y,n.user||"",e):0<=c.indexOf("#")?s.hash(r,t,f,u,c,n,y):s.any(r,t,f,u,c,n,y,n.user||""):s.pubs(r,t,f,u,c,n,y):s.alias(r,t,f,u,c,n,y)}}i.on("opt",function(t){t.sea||(t.sea={own:{}},t.on("put",s,t)),this.to.next(t)}),s.hash=function(t,e,r,n,a,i,s){o.work(r,null,function(r){if(r&&r===n.split("#").slice(-1)[0])return t.to.next(e);s("Data hash not same as hash!")},{name:"SHA-256"})},s.alias=function(t,e,r,n,o,a,i){return r?"~@"+n===u(r)?t.to.next(e):void i("Alias not same!"):i("Data must exist!")},s.pubs=function(t,e,r,n,o,a,i){return r?n===u(r)?t.to.next(e):void i("Alias not same!"):i("Alias must exist!")},s.pub=async function(t,e,r,s,c,f,p,l,y){var h;const g=await a.parse(r)||{},w=(r,a,u)=>{if(r.m&&r.s&&a&&y)return o.verify(r,y,r=>{if(n!==r&&n!==r.e&&e.put[">"]&&e.put[">"]>parseFloat(r.e))return p("Certificate expired.");if(n!==r&&r.c&&r.w&&(r.c===a||r.c.indexOf("*")>-1)){let e=c.indexOf("/")>-1?c.replace(c.substring(0,c.indexOf("/")+1),""):"";String.match=String.match||i.text.match;const n=Array.isArray(r.w)?r.w:"object"==typeof r.w||"string"==typeof r.w?[r.w]:[];for(const i of n)if(String.match(e,i["#"])&&String.match(s,i["."])||!i["."]&&String.match(e,i["#"])||!i["#"]&&String.match(s,i["."])||String.match(e?e+"/"+s:s,i["#"]||i)){if(i["+"]&&i["+"].indexOf("*")>-1&&e&&-1==e.indexOf(a)&&-1==s.indexOf(a))return p(`Path "${e}" or key "${s}" must contain string "${a}".`);if(r.wb&&("string"==typeof r.wb||(r.wb||{})["#"])){var o=t.as.root.$.back(-1);return"string"==typeof r.wb&&"~"!==r.wb.slice(0,1)&&(o=o.get("~"+y)),o.get(r.wb).get(a).once(t=>!t||1!==t&&!0!==t?u(r):p(`Certificant ${a} blocked.`))}return u(r)}return p("Certificate verification fail.")}})};if("pub"===s&&"~"+y===c)return r===y?t.to.next(e):p("Account not same!");(h=l.is)&&h.pub&&!g["*"]&&!g["+"]&&(y===h.pub||y!==h.pub&&((e._.msg||{}).opt||{}).cert)?o.opt.pack(e.put,i=>{o.sign(i,l._.sea,async function(i){if(n===i)return p(o.err||"Signature fail.");if(e.put[":"]={":":h=o.opt.unpack(i.m),"~":i.s},e.put["="]=h,y===l.is.pub)return(h=u(r))&&((f.sea.own[h]=f.sea.own[h]||{})[y]=1),void JSON.stringifyAsync(e.put[":"],function(r,n){return r?p(r||"Stringify error."):(e.put[":"]=n,t.to.next(e))});if(y!==l.is.pub&&((e._.msg||{}).opt||{}).cert){const r=await a.parse(e._.msg.opt.cert);r&&r.m&&r.s&&w(r,l.is.pub,n=>{e.put[":"]["+"]=r,e.put[":"]["*"]=l.is.pub,JSON.stringifyAsync(e.put[":"],function(r,n){return r?p(r||"Stringify error."):(e.put[":"]=n,t.to.next(e))})})}},{raw:1})}):o.opt.pack(e.put,r=>{o.verify(r,g["*"]||y,function(r){var a;return r=o.opt.unpack(r),n===r?p("Unverified data."):((a=u(r))&&y===o.opt.pub(a)&&((f.sea.own[a]=f.sea.own[a]||{})[y]=1),g["+"]&&g["+"].m&&g["+"].s&&g["*"]?void w(g["+"],g["*"],n=>(e.put["="]=r,t.to.next(e))):(e.put["="]=r,t.to.next(e)))})})},s.any=function(t,e,r,n,o,a,i,s){if(a.opt.secure)return i("Soul missing public key at '"+n+"'.");a.on("secure",function(e){if(this.off(),!a.opt.secure)return t.to.next(e);i("Data cannot be changed.")}).on.on("secure",e)};var c=i.valid,u=function(t,e){return"string"==typeof(e=c(t))&&e},f=((i.state||"").ify,/[^\w_-]/);o.opt.pub=function(t){if(t&&(t=t.split("~"))&&(t=t[1])&&(t=t.split(f).slice(0,2))&&2==t.length&&"@"!==(t[0]||"")[0])return t=t.slice(0,2).join(".")},o.opt.stringy=function(t){},o.opt.pack=function(t,e,r,a,s){var c,u;if(o.opt.check(t))return e(t);t&&t["#"]&&t["."]&&t[">"]&&(c=t[":"],u=1),JSON.parseAsync(u?c:t,function(o,c){var u=n!==(c||"")[":"]&&(c||"")["~"];e(u?{m:{"#":s||t["#"],".":r||t["."],":":(c||"")[":"],">":t[">"]||i.state.is(a,r)},s:u}:t)})};var p=o.opt;o.opt.unpack=function(t,e,r){var a;if(n!==t){if(t&&n!==(a=t[":"]))return a;if(e=e||p.fall_key,!r&&p.fall_val&&((r={})[e]=p.fall_val),e&&r){if(t===r[e])return t;if(!o.opt.check(r[e]))return t;var s=r&&r._&&r._["#"]||p.fall_soul,c=i.state.is(r,e)||p.fall_state;return t&&4===t.length&&s===t[0]&&e===t[1]&&l(c)===l(t[3])?t[2]:c<o.opt.shuffle_attack?t:void 0}}},o.opt.shuffle_attack=15463296e5;var l=Math.floor})(t,"./index")}();
