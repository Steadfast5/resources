!function(){function t(n,e){return e?require(n):n.slice?t[o(n)]:function(e,i){n(e={exports:{}}),t[o(i)]=e.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var n=module;t(function(t){String.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t-- >0;)e+=n.charAt(Math.floor(Math.random()*n.length));return e},String.match=function(t,n){var e,o;return"string"==typeof t&&("string"==typeof n&&(n={"=":n}),t===(e=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},String.hash=function(t,n){if("string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}};var n,e,o,i,r=Object.prototype.hasOwnProperty;Object.plain=function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])},Object.empty=function(t,n){for(var e in t)if(r.call(t,e)&&(!n||-1==n.indexOf(e)))return!1;return!0},Object.keys=Object.keys||function(t){var n=[];for(var e in t)r.call(t,e)&&n.push(e);return n},n=setTimeout,e=0,o=0,i=typeof setImmediate!=""+void 0&&setImmediate||n,n.poll=n.poll||function(t){1>=+new Date-e&&o++<3333?t():i(function(){e=+new Date,t()},o=0)},function(){var t,n=setTimeout,e=n.turn=n.turn||function(t){1==o.push(t)&&i(a)},o=e.s=[],i=n.poll,r=0,a=function(){(t=o[r++])&&t(),r!=o.length&&99!=r||(o=e.s=o.slice(r),r=0),o.length&&i(a)}}(),function(){var t,n=setTimeout,e=n.turn;(n.each=n.each||function(n,o,i,r){r=r||9,function a(s,u,c){if(u=(s=(n||[]).splice(0,r)).length){for(var f=0;f<u&&t===(c=o(s[f]));f++);if(t===c)return void e(a)}i&&i(c)}()})()}()})(t,"./shim"),t(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};var i="function"==typeof e;n=(this.tag||(this.tag={}))[n]||i&&(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if(i){var r={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(r.back=n.last||n).to=r,n.last=r}return(n=n.to)&&void 0!==e&&n.next(e),n}})(t,"./onto"),t(function(n){t("./shim"),n.exports=function(t){return void 0!==t&&(null===t||t!==1/0&&(t==t&&("string"==typeof t||"boolean"==typeof t||"number"==typeof t||!(!t||"string"!=typeof(t["#"]||0)||!Object.empty(t,["#"]))&&t["#"])))}})(t,"./valid"),t(function(n){function e(){var t=+new Date;return a<t?(i=0,a=t+e.drift):a=t+(i+=1)/r+e.drift}t("./shim"),e.drift=0;var o,i=0,r=999,a=-1/0;e.is=function(t,n,e){var o=n&&t&&t._&&t._[">"]||e;if(o)return"number"==typeof(o=o[n])?o:-1/0},e.ify=function(t,n,e,i,r){(t=t||{})._=t._||{},r&&(t._["#"]=r);var a=t._[">"]||(t._[">"]={});return o!==n&&"_"!==n&&("number"==typeof e&&(a[n]=e),o!==i&&(t[n]=i)),t},n.exports=e})(t,"./state"),t(function(n){t("./shim"),n.exports=function(t){var n={s:{}},e=n.s;t=t||{max:999,age:9e3},n.check=function(t){return!!e[t]&&o(t)};var o=n.track=function(o){var i=e[o]||(e[o]={});return i.was=n.now=+new Date,n.to||(n.to=setTimeout(n.drop,t.age+9)),i};return n.drop=function(o){n.to=null,n.now=+new Date;var i=Object.keys(e);console.STAT&&console.STAT(n.now,+new Date-n.now,"dup drop keys"),setTimeout.each(i,function(i){var r=e[i];r&&(o||t.age)>n.now-r.was||delete e[i]},0,99)},n}})(t,"./dup"),t(function(n){t("./onto"),n.exports=function(t,n){if(this.on){var o=(this.opt||{}).lack||9e3;if("function"!=typeof t){if(!t)return;var i=t["#"]||t,r=(this.tag||"")[i];if(!r)return;return n&&(r=this.on(i,n),clearTimeout(r.err),r.err=setTimeout(function(){r.off()},o)),!0}i=n&&n["#"]||e(9);if(!t)return i;var a=this.on(i,t,n);return a.err=a.err||setTimeout(function(){a.off(),a.next({err:"Error: No ACK yet.",lack:!0})},o),i}};var e=String.random||function(){return Math.random().toString(36).slice(2)}})(t,"./ask"),t(function(e){function o(t){return t instanceof o?(this._={$:this}).$:this instanceof o?o.create(this._={$:this,opt:t}):new o(t)}o.is=function(t){return t instanceof o||t&&t._&&t===t._.$||!1},o.version=.202,o.chain=o.prototype,o.chain.toJSON=function(){},t("./shim"),o.valid=t("./valid"),o.state=t("./state"),o.on=t("./onto"),o.dup=t("./dup"),o.ask=t("./ask"),function(){function t(e){if(e)if(e.out!==t){var i,r=this.as,u=r.at||r,c=u.$,f=u.dup,l=e.DBG;if((i=e["#"])||(i=e["#"]=s(9)),!f.check(i)){if(f.track(i),i=e._,e._="function"==typeof i?i:function(){},e.$&&e.$===(e.$._||"").$||(e.$=c),e["@"]&&!e.put&&function(t){var n,e=t["@"]||"";if(!(n=e._))return;n.acks=(n.acks||0)+1,(n.err=t.err)&&(t["@"]=n["#"],a(n));n.stop||n.crack||(n.crack=n.match&&n.match.push(function(){p(n)}));p(n)}(e),!u.ask(e["@"],e)){if(l&&(l.u=+new Date),e.put)return void n(e);e.get&&o.on.get(e,c)}l&&(l.uc=+new Date),this.to.next(e),l&&(l.ua=+new Date),e.nts||e.NTS||(e.out=t,u.on("out",e),l&&(l.ue=+new Date))}}else this.to.next(e)}function n(n){if(n){var o=n._||"",r=o.root=((o.$=n.$||"")._||"").root;if(n["@"]&&o.faith&&!o.miss)return n.out=t,void r.on("out",n);o.latch=r.hatch,o.match=r.hatch=[];var s=n.put,f=o.DBG=n.DBG,l=+new Date;if(!s["#"]||!s["."]){f&&(f.p=l),o["#"]=n["#"],o.msg=n,o.all=0,o.stun=1;var h=Object.keys(s);console.STAT&&console.STAT(l,((f||o).pk=+new Date)-l,"put sort");var p,v,y,k,m,b,_,$=0;!function t(r){if(p!=$){if(p=$,!(y=h[$]))return console.STAT&&console.STAT(l,((f||o).pd=+new Date)-l,"put"),void a(o);(k=s[y])?(_=k._)?y!==_["#"]?b=d+g(y)+"soul not same.":(m=_[">"])||(b=d+g(y)+"no state."):b=d+g(y)+"no meta.":b=d+g(y)+"no node.",v=Object.keys(k||{})}if(b)return n.err=o.err=b,void a(o);var w,j=0;for(r=r||0;r++<9&&(w=v[j++]);)if("_"!==w){var x=k[w],T=m[w];if(i===T){b=d+g(w)+"on"+g(y)+"no state.";break}if(!c(x)){b=d+g(w)+"on"+g(y)+"bad "+typeof x+g(x);break}e(x,w,y,T,n)}(v=v.slice(j)).length?u(t):(++$,v=null,t(r))}()}}}function e(t,n,o,i,r){var a,s=r._||"",u=s.root,c=u.graph,l=c[o]||h,p=f(l,n,1),d=l[n],g=s.DBG;(a=console.STAT)&&(c[o]&&d||(a.has=(a.has||0)+1));var m=k();if(i>m)return setTimeout(function(){e(t,n,o,i,r)},(a=i-m)>y?y:a),void(console.STAT&&console.STAT((g||s).Hf=+new Date,a,"future"));if((!(i<p)||s.miss)&&(s.faith||i!==p||!(t===d||v(t)<=v(d))||s.miss)){s.stun++;var b=r["#"]+s.all++,_={toString:function(){return b},_:s};_.toJSON=_.toString,g&&(g.ph=g.ph||+new Date),u.on("put",{"#":_,"@":r["@"],put:{"#":o,".":n,":":t,">":i},_:s})}}function r(t){var n;(n=(t._||"").DBG)&&(n.pa=+new Date,n.pm=n.pm||+new Date);var e,o=this.as,i=o.graph,r=t._,s=t.put,u=s["#"],c=s["."],f=s[":"],h=s[">"];t["#"];(e=r.msg)&&(e=e.put)&&(e=e[u])&&l(e,c,h,f,u),i[u]=l(i[u],c,h,f,u),(e=(o.next||"")[u])&&e.on("in",t),a(r),this.to.next(t)}function a(n,e){var o;if(!n.stop&&(n.err||!(0<--n.stun))&&(n.stop=1,o=n.root)){var i=n.match;i.end=1,i===o.hatch&&(!(i=n.latch)||i.end?delete o.hatch:o.hatch=i),n.hatch&&n.hatch(),setTimeout.each(n.match,function(t){t&&t()}),!(e=n.msg)||n.err||e.err||(e.out=t,n.root.on("out",e))}}function p(t){t&&t.root&&(t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?i:{"":1}}))}o.create=function(n){n.root=n.root||n,n.graph=n.graph||{},n.on=n.on||o.on,n.ask=n.ask||o.ask,n.dup=n.dup||o.dup();var e=n.$.opt(n.opt);return n.once||(n.on("in",t,n),n.on("out",t,n),n.on("put",r,n),o.on("create",n),n.on("create",n)),n.once=1,e},o.on.put=n;var d="Error: Invalid graph!",g=function(t){return" '"+(""+t).slice(0,9)+"...' "},v=JSON.stringify,y=2147483647,k=o.state}(),function(){function t(t,n){var e=+new Date,o=t._||{},r=o.DBG=t.DBG,a=t["#"],u=s(9),c=Object.keys(n||"").sort(),h=((n||"")._||"")["#"],p=(c.length,t.$._.root),d=n===p.graph[h];console.STAT&&console.STAT(e,((r||o).gk=+new Date)-e,"got keys"),n&&function t(){e=+new Date;for(var o,g,v,y=0,k={};y<9&&(o=c[y++]);)l(k,o,f(n,o),n[o],h);c=c.slice(y),(g={})[h]=k,k=g,d&&((v=function(){}).ram=v.faith=!0),g=c.length,console.STAT&&console.STAT(e,-(e-(e=+new Date)),"got copied some"),r&&(r.ga=+new Date),p.on("in",{"@":a,"#":u,put:k,"%":g?u=s(9):i,$:p.$,_:v,DBG:r}),console.STAT&&console.STAT(e,+new Date-e,"got in"),g&&setTimeout.turn(t)}(),n||p.on("in",{"@":t["#"]})}o.on.get=function(n,e){var o=e._,r=n.get,a=r["#"],s=o.graph[a],u=r["."],c=((o.next||(o.next={}))[a],(n._||{}).DBG=n.DBG);if(c&&(c.g=+new Date),!s)return o.on("get",n);if(u){if("string"!=typeof u||i===s[u])return o.on("get",n);s=l({},u,f(s,u),s[u],a)}s&&t(n,s),o.on("get",n)},o.on.get.ack=t}(),o.chain.opt=function(t){t=t||{};var n=this._,e=t.peers||t;return Object.plain(t)||(t={}),Object.plain(n.opt)||(n.opt=t),"string"==typeof e&&(e=[e]),e instanceof Array&&(Object.plain(n.opt.peers)||(n.opt.peers={}),e.forEach(function(t){var e={};e.id=e.url=t,n.opt.peers[t]=n.opt.peers[t]||e})),n.opt.peers=n.opt.peers||{},a(t,function t(n){var e=this[n];this&&this.hasOwnProperty(n)||"string"==typeof e||Object.empty(e)?this[n]=e:(!e||e.constructor===Object||e instanceof Array)&&a(e,t)}),o.on("opt",n),n.opt.uuid=n.opt.uuid||function(t){return o.state().toString(36).replace(".","")+String.random(t||12)},this};var i,r,a=function(t,n){Object.keys(t).forEach(n,t)},s=String.random,u=setTimeout.turn,c=o.valid,f=o.state.is,l=o.state.ify,h={};o.log=function(){return!o.log.off&&r.log.apply(r,arguments),[].slice.call(arguments).join(" ")},o.log.once=function(t,n,e){return(e=o.log.once)[t]=e[t]||0,e[t]++||o.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=o).window=window);try{void 0!==n&&(n.exports=o)}catch(t){}e.exports=o,(o.window||{}).console=(o.window||{}).console||{log:function(){}},(r=console).only=function(t,n){return r.only.i&&t===r.only.i&&r.only.i++&&(r.log.apply(r,arguments)||n)},o.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(n){t("./root").chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var i=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var r=0,a=t.length,s=i;r<a;r++)s=(s||o)[t[r]];return e!==s?n?this:s:(s=i.back)?s.$.back(t,n):void 0}if("function"==typeof t){var u;for(s={back:i};(s=s.back)&&e===(u=t(s,n)););return u}return"number"==typeof t?(i.back||i).$.back(t-1):this};var e,o={}})(t,"./back"),t(function(n){var e=t("./root");function o(t,n){if(n=n||this.as||t.$._,(!t.$$||this===e.on)&&t.put&&!n.soul){var o=t.put||"",i=o["="]||o[":"],r=n.root,a=r.$.get(o["#"]).get(o["."])._;if("string"==typeof(i=c(i))){if(!(a.echo||(a.echo={}))[n.id]||(r.pass||"")[n.id]){if(s=r.pass){if(s[i+n.id])return;s[i+n.id]=1}(a.echo||(a.echo={}))[n.id]=n,n.has&&(n.link=i);var s,u=r.$.get(a.link=i)._;(u.echo||(u.echo={}))[a.id]=a,((s=n.ask||"")[""]||n.lex)&&u.on("out",{get:{"#":i}}),setTimeout.each(Object.keys(s),function(t,n){t&&(n=s[t])&&n.on("out",{get:{"#":i,".":t}})},0,99)}}else this===e.on&&((a.echo||(a.echo={}))[n.id]=n)}}function i(t,n){var e,o,r=t.put||"",s=a!==r["="]?r["="]:r[":"],u=n.root;if(a===s){if(n.soul&&a!==n.put)return;if(o=(t.$$||t.$||"")._||"",t["@"]&&(a!==o.put||a!==n.put))return;return(e=n.link||t.linked)&&delete(u.$.get(e)._.echo||"")[n.id],n.has&&(n.link=null),n.put=a,void setTimeout.each(Object.keys(n.next||""),function(t,o){(o=n.next[t])&&(e&&delete(u.$.get(e).get(t)._.echo||"")[o.id],o.on("in",{get:t,put:a,$:o.$}))},0,99)}n.soul||t.$$||(e=c(s),o=t.$._||"",(e!==o.link&&(!n.has||o.link)||(u.pass||"")[n.id]&&"string"!=typeof e)&&(delete(o.echo||"")[n.id],i({get:n.get,put:a,$:t.$,linked:t.linked=t.linked||o.link},n)))}function r(t,n){var o=this.as,i=o.$._,r=(i.root,o.get||""),s=(t.put||"")[r["#"]]||"";if(!t.put||"string"==typeof r["."]&&a===s[r["."]]){if(a!==i.put)return;if(!i.soul&&!i.has)return;return i.ack=(i.ack||0)+1,void i.on("in",{get:i.get,put:i.put=a,$:i.$,"@":t["@"]})}(t._||{}).miss=1,e.on.put(t)}e.chain.chain=function(t){var n,o=this._,i=new(t||this).constructor(this),r=i._;return r.root=n=o.root,r.id=++n.once,r.back=this._,r.on=e.on,r.on("in",e.on.in,r),r.on("out",e.on.out,r),i},e.on.out=function(t){var n,e,o=this.as,i=o.back,s=o.root;if(t.$||(t.$=o.$),this.to.next(t),!o.err){if(n=t.get){if(s.pass&&(s.pass[o.id]=o),o.lex&&Object.keys(o.lex).forEach(function(t){e[t]=o.lex[t]},e=t.get=t.get||{}),n["#"]||o.soul){if(n["#"]=n["#"]||o.soul,t["#"]||(t["#"]=u(9)),i=s.$.get(n["#"])._,n=n["."]){if(f(i.put,n)&&(e=i.ask&&i.ask[n],(i.ask||(i.ask={}))[n]=i.$.get(n)._,i.on("in",{get:n,put:{"#":i.soul,".":n,":":i.put[n],">":h(s.graph[i.soul],n)}}),e))return}else{if(e=i.ask&&i.ask[""],(i.ask||(i.ask={}))[""]=i,a!==i.put&&(i.on("in",i),e))return;t.$=i.$}return s.ask(r,t),s.on("in",t)}if(n["."])return o.get?(t={get:{".":o.get},$:o.$},(i.ask||(i.ask={}))[o.get]=t.$._,i.on("out",t)):(t={get:o.lex?t.get:{},$:o.$},i.on("out",t));if((o.ask||(o.ask={}))[""]=o,o.get)return n["."]=o.get,(i.ask||(i.ask={}))[o.get]=t.$._,i.on("out",t)}return i.on("out",t)}o.on("in",{put:o.put=a,$:o.$})},e.on.in=function(t,n){var e,r=(n=n||this.as).root,u=t.$||(t.$=n.$),f=(u||"")._||s,l=t.put||"",d=l["#"],g=l["."],v=a!==l["="]?l["="]:l[":"],y=l[">"]||-1/0;if(a!==t.put&&(a===l["#"]||a===l["."]||a===l[":"]&&a===l["="]||a===l[">"]))return c(l)?void n.on("in",{$:f.back.$,put:{"#":d=f.back.soul,".":g=f.has||f.get,"=":l,">":h(f.back.put,g)},via:t}):(d=((l||"")._||"")["#"])?(u=n.root.$.get(d),setTimeout.each(Object.keys(l).sort(),function(e){"_"!=e&&a!==(y=h(l,e))&&n.on("in",{$:u,put:{"#":d,".":e,"=":l[e],">":y},VIA:t})})):void console.log("chain not yet supported for",l,"...",t,n);(t.seen||"")[n.id]||((t.seen||(t.seen=function(){}))[n.id]=n,n!==f&&(Object.keys(t).forEach(function(n){l[n]=t[n]},l={}),l.get=n.get||l.get,n.soul||n.has?f.soul&&(l.$=n.$,l.$$=l.$$||f.$):l.$$$=l.$$$||n.$,t=l),i(t,n),(n.soul||t.$$)&&y>=h(r.graph[d],g)&&((l=r.$.get(d)._).put=p(l.put,g,y,v,d)),!f.soul&&y>=h(r.graph[d],g)&&(e=(r.$.get(d)._.next||"")[g])&&(e.put=v,"string"==typeof(l=c(v))&&(e.put=r.$.get(l)._.put||v)),this.to&&this.to.next(t),n.any&&setTimeout.each(Object.keys(n.any),function(e){(e=n.any[e])&&e(t)},0,99),n.echo&&setTimeout.each(Object.keys(n.echo),function(e){(e=n.echo[e])&&e.on("in",t)},0,99),((t.$$||"")._||f).soul&&(e=n.next)&&(e=e[g])&&(l={},Object.keys(t).forEach(function(n){l[n]=t[n]}),l.$=(t.$$||t.$).get(l.get=g),delete l.$$,delete l.$$$,e.on("in",l)),o(t,n))},e.on.link=o,e.on.unlink=i;var a,s={},u=String.random,c=e.valid,f=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},l=e.state,h=l.is,p=l.ify})(t,"./chain"),t(function(n){var e=t("./root");function o(t){var n=this.at||this.on;if(!t||n.soul||n.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){var e;n.map;if((e=this.seen||(this.seen={}))[t])return!0;e[t]=!0}}e.chain.get=function(t,n,s){var u,c;if("string"==typeof t){if(0==t.length)return(u=this.chain())._.err={err:e.log("0 length key!",t)},n&&n.call(u,u._.err),u;(u=((l=this._).next||r)[t])||(u=t&&function(t,n){var e=n._,o=e.next,i=n.chain()._;o||(o=e.next={});o[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t);return i}(t,this)),u=u&&u.$}else{if("function"==typeof t){if(!0===n)return function(t,n,o,r){var a,s=t._,u=0;if(a=s.soul||s.link)return n(a,r,s);if(s.jam)return s.jam.push([n,r]);s.jam=[[n,r]],t.get(function(t,n){if(!(i===t.put&&!s.root.opt.super&&(a=Object.keys(s.root.opt.peers).length)&&++u<=a)){n.rid(t);var o,r=(r=t.$)&&r._||{},c=0;for(a=s.jam,delete s.jam;o=a[c++];){var f=o[0];o=o[1],f&&f(r.link||r.soul||e.valid(t.put)||((t.put||{})._||{})["#"],o,t,n)}}},{out:{get:{".":!0}}})}(this,t,0,s),this;var f,l=(u=this)._,h=n||{},p=l.root;h.at=l,h.ok=t;var d={};function g(t,n,o){if(!g.stun&&(!(r=p.pass)||r[f])){var r,a=t.$._,s=(t.$$||"")._,u=(s||a).put,c=!a.has&&!a.soul,v={};if((c||i===u)&&(u=i===((r=t.put)||"")["="]?i===(r||"")[":"]?r:r[":"]:r["="]),"string"==typeof(r=e.valid(u))&&(u=i===(r=p.$.get(r)._.put)?h.not?i:u:r),!h.not||i!==u){if(i===h.stun){if((r=p.stun)&&r.on&&(l.$.back(function(t){if(r.on(""+t.id,v={}),(v.run||0)<g.id)return v}),!v.run&&r.on(""+a.id,v={}),!v.run&&s&&r.on(""+s.id,v={}),g.id>v.run&&(v.stun&&!v.stun.end||(v.stun=r.on("stun"),v.stun=v.stun&&v.stun.last),v.stun&&!v.stun.end)))return void((v.stun.add||(v.stun.add={}))[f]=function(){g(t,n,1)});if(i===u&&(o=0),(r=p.hatch)&&!r.end&&i===h.hatch&&!o){if(d[a.$._.id])return;return d[a.$._.id]=1,void r.push(function(){g(t,n,1)})}d={}}if(p.pass){if(p.pass[f+a.id])return;p.pass[f+a.id]=1}h.on?h.ok.call(a.$,u,a.get,t,n||g):h.v2020?h.ok(t,n||g):(Object.keys(t).forEach(function(n){r[n]=t[n]},r={}),(t=r).put=u,h.ok.call(h.as,t,n||g))}}}return g.at=l,(l.any||(l.any={}))[f=String.random(7)]=g,g.off=function(){g.stun=1,l.any&&delete l.any[f]},g.rid=o,g.id=h.run||++p.once,c=p.pass,(p.pass={})[f]=1,h.out=h.out||{get:{}},l.on("out",h.out),p.pass=c,u}if("number"==typeof t)return this.get(""+t,n,s);if("string"==typeof(c=a(t)))return this.get(c,n,s);(c=this.get.next)&&(u=c(this,t))}return u?(n&&"function"==typeof n&&u.get(n,s),u):((u=this.chain())._.err={err:e.log("Invalid get request!",t)},n&&n.call(u,u._.err),u)};var i,r={},a=e.valid})(t,"./get"),t(function(n){var e=t("./root");function o(t,n){if(n){n=(n._||"").id||n;var o,i=t.root.stun||(t.root.stun={on:e.on}),r={};t.stun||(t.stun=i.on("stun",function(){})),(o=i.on(""+n))&&o.the.last.next(r),r.run>=t.run||i.on(""+n,function(n){if(t.stun.end)return this.off(),void this.to.next(n);n.run=n.run||t.run,n.stun=n.stun||t.stun})}}function i(t){if(t.err)i.end(t.stun,t.root);else if(!t.todo.length&&!t.end&&Object.empty(t.wait)){t.end=1;var n,o=t.$.back(-1)._,r=o.root,a=o.ask(function(n){r.on("ack",n),n.err&&e.log(n),++s>(t.acks||0)&&this.off(),t.ack&&t.ack(n,this)},t.opt),s=0,u=t.stun;(n=function(){u&&(i.end(u,r),setTimeout.each(Object.keys(u=u.add||""),function(t){(t=u[t])&&t()}))}).hatch=n,t.via._.on("out",{put:t.out=t.graph,opt:t.opt,"#":a,_:n})}}e.chain.put=function(t,n,f){var l=this,h=l._,p=h.root;(f=f||{}).root=h.root,f.run||(f.run=p.once),o(f,h.id),f.ack=f.ack||n,f.via=f.via||l,f.data=f.data||t,f.soul||(f.soul=h.soul||"string"==typeof n&&n);var d=f.state=f.state||e.state();return"function"==typeof t?(t(function(t){f.data=t,l.put(r,r,f)}),l):f.soul?(f.$=p.$.get(f.soul),f.todo=[{it:f.data,ref:f.$}],f.turn=f.turn||s,f.ran=f.ran||i,function t(){var n,i,r,s,l,h=f.todo,p=h.pop(),g=p.it;p.ref&&p.ref._.id;if(o(f,p.ref),(s=p.todo)&&(g=g[i=s.pop()],s.length&&h.push(p)),i&&(h.path||(h.path=[])).push(i),!(n=u(g))&&!(l=e.is(g))){if(!Object.plain(g))return(f.ack||a).call(f,f.out={err:f.err=e.log("Invalid data: "+(g&&(s=g.constructor)&&s.name||typeof g)+" at "+(f.via.back(function(t){t.get&&s.push(t.get)},s=[])||s.join("."))+"."+(h.path||[]).join("."))}),void f.ran(f);for(var v=f.seen||(f.seen=[]),y=v.length;y--;)if(g===(s=v[y]).it){n=g=s.link;break}}if(i&&n)p.node=c(p.node,i,d,g);else{f.seen.push(r={it:g,link:{},todo:l?[]:Object.keys(g).sort().reverse(),path:(h.path||[]).slice(),up:p}),p.node=c(p.node,i,d,r.link),!l&&r.todo.length&&h.push(r);var k=f.seen.length;function m(t,n){var e=r.link["#"];n&&(n.off(),n.rid(t));var i=e||t.soul||(s=(t.$$||t.$)._||"").soul||s.link||((s=s.put||"")._||"")["#"]||s["#"]||((s=t.put||"")&&t.$$?s["#"]:(s["="]||s[":"]||"")["#"]);!e&&o(f,t.$),i||p.link["#"]?(i||(i=[],(t.$$||t.$).back(function(t){if(s=t.soul||t.link)return i.push(s);i.push(t.get)}),i=i.reverse().join("/")),r.link["#"]=i,!l&&(((f.graph||(f.graph={}))[i]=r.node||(r.node={_:{}}))._["#"]=i),delete f.wait[k],r.wait&&setTimeout.each(r.wait,function(t){t&&t()}),f.ran(f)):(p.wait||(p.wait=[])).push(function(){m(t,n)})}(f.wait||(f.wait={}))[k]="",s=(r.ref=l?g:i?p.ref.get(i):p.ref)._,(s=g&&(g._||"")["#"]||s.soul||s.link)?m({soul:s}):r.ref.get(m,{run:f.run,v2020:1,out:{get:{".":" "}}})}if(!h.length)return f.ran(f);f.turn(t)}(),l):(function(t){var n,e=t.via._;t.via=t.via.back(function(e){if(e.soul||!e.get)return e.$;n=t.data,(t.data={})[e.get]=n}),t.via&&t.via._.soul||(t.via=e.root.$.get(((t.data||"")._||"")["#"]||e.$.back("opt.uuid")()));t.via.put(t.data,t.ack,t)}(f),l)},i.end=function(t,n){t.end=a,t.the.to===t&&t===t.the.last&&delete n.stun,t.off()};var r,a=function(){},s=setTimeout.turn,u=e.valid,c=e.state.ify})(t,"./put"),t(function(n){var e=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),n.exports=e})(t,"./index"),t(function(n){var e=t("./index");e.chain.on=function(t,n,e,o){var i,r=this._;r.root;if("string"==typeof t)return n?(i=r.on(t,n,e||r,o),e&&e.$&&(e.subs||(e.subs=[])).push(i),this):r.on(t);var a=n;return(a=!0===a?{change:!0}:a||{}).not=1,a.on=1,this.get(t,a),this},e.chain.once=function(t,n){if(n=n||{},!t)return function(t,n,o){return e.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(o=t.chain())._.nix=t.once(function(t,n){o._.on("in",this._)}),o._.lex=t._.lex,o}(this);var i,r=this._,a=r.root,s=(r.put,String.random(7));return this.get(function(u,c,f,l){var h=this,p=h._,d=p.one||(p.one={});function g(){p.has||p.soul||(p={put:u,get:c}),o===(i=p.put)&&(i=((f.$$||"")._||"").put),"string"==typeof e.valid(i)&&(i=a.$.get(i)._.put)===o||l.stun||""!==d[s]&&(d[s]="",(r.soul||r.has)&&l.off(),t.call(h,i,p.get))}l.stun||""!==d[s]&&(!0!==(i=e.valid(u))?"string"!=typeof i&&(clearTimeout((r.one||"")[s]),clearTimeout(d[s]),d[s]=setTimeout(g,n.wait||99)):g())},{on:1}),this},e.chain.off=function(){var t,n=this._,e=n.back;if(e)return n.ack=0,(t=e.next)&&t[n.get]&&delete t[n.get],(t=e.ask)&&delete t[n.get],(t=e.put)&&delete t[n.get],(t=n.soul)&&delete e.root.graph[t],(t=n.map)&&Object.keys(t).forEach(function(n,o){(o=t[n]).link&&e.root.$.get(o.link).off()}),(t=n.next)&&Object.keys(t).forEach(function(n,e){t[n].$.off()}),n.on("off",{}),this};var o})(t,"./on"),t(function(n){var e=t("./index"),o=e.chain.get.next;function i(t){this.to.next(t);var n,o=this.as,i=t.$._,r=t.put;(i.soul||t.$$)&&((n=o.lex)&&!String.match(t.get||(r||"")["."],n["."]||n["#"]||n)||e.on.link(t,o))}e.chain.get.next=function(t,n){var e;return Object.plain(n)?(e=((e=n["#"])||"")["="]||e)?t.get(e):((e=t.chain()._).lex=n,t.on("in",function(t){String.match(t.get||(t.put||"")["."],n["."]||n["#"]||n)&&e.on("in",t),this.to.next(t)}),e.$):(o||a)(t,n)},e.chain.map=function(t,n,o){var s,u,c=this._;return Object.plain(t)&&(s=t["."]?t:{".":t},t=r),t?(e.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),u=this.chain(),this.map().on(function(n,o,i,s){var c=(t||a).call(this,n,o,i,s);if(r!==c){if(n===c)return u._.on("in",i);if(e.is(c))return u._.on("in",c._);var f={};Object.keys(i.put).forEach(function(t){f[t]=i.put[t]},f),f["="]=c,u._.on("in",{get:o,put:f})}}),u):(u=c.each)?u:((c.each=u=this.chain())._.lex=s||u._.lex||c.lex,u._.nix=this.back("nix"),this.on("in",i,u._),u)};var r,a=function(){}})(t,"./map"),t(function(n){var e=t("./index");e.chain.set=function(t,n,o){var i,r,a=this,s=a.back(-1);return n=n||function(){},(o=o||{}).item=o.item||t,(i=((t||"")._||"")["#"])&&((t={})["#"]=i),"string"==typeof(r=e.valid(t))?a.get(i=r).put(t,n,o):e.is(t)?(a.put(function(o){t.get(function(t,i,s){if(!t)return n.call(a,{err:e.log('Only a node can be linked! Not "'+s.put+'"!')});(r={})[t]={"#":t},o(r)},!0)}),t):(Object.plain(t)&&(t=s.get(i=a.back("opt.uuid")()).put(t)),a.get(i||s.back("opt.uuid")(7)).put(t,n,o))}})(t,"./set"),t(function(n){t("./shim");var e;try{n.exports=function(t){var n=function(){},o=t.opt||{};o.log=o.log||console.log,o.gap=o.gap||o.wait||0,o.max=o.max||.3*(o.memory?999*o.memory*999:3e8),o.pack=o.pack||.01*o.max*.01,o.puff=o.puff||9;var i=setTimeout.turn||setTimeout,r=JSON.parseAsync||function(t,n,e){try{n(void 0,JSON.parse(t,e))}catch(t){n(t)}},a=JSON.stringifyAsync||function(t,n,e,o){try{n(void 0,JSON.stringify(t,e,o))}catch(t){n(t)}},s=t.dup,u=s.check,c=s.track,f=(new Date,n.hear=function(t,e){if(t){if(o.max<=t.length)return n.say({dam:"!",err:"Message too big!"},e);n===this&&(f.d+=t.length||0,++f.c);var a,s=e.SH=+new Date,u=t[0];return"["===u?(r(t,function(t,r){if(t||!r)return n.say({dam:"!",err:"DAM JSON parse error."},e);console.STAT&&console.STAT(+new Date,r.length,"# on hear batch");var a=o.puff;!function t(){for(var n,o=+new Date,s=0;s<a&&(n=r[s++]);)f(n,e);r=r.slice(s),console.STAT&&console.STAT(o,+new Date-o,"hear loop"),l(e),r.length&&i(t,0)}()}),void(t="")):"{"===u||(t["#"]||Object.plain(t))&&(a=t)?a?f.one(a,e,s):void r(t,function(t,o){if(t||!o)return n.say({dam:"!",err:"DAM JSON parse error."},e);f.one(o,e,s)}):void 0}});function l(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(3>n.length):n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(t){return o.log("DAM JSON stringify error",t)}n&&h(n,t)}}function h(t,e){try{var o=e.wire;e.say?e.say(t):o.send&&o.send(t),n.say.d+=t.length||0,++n.say.c}catch(n){(e.queue=e.queue||[]).push(t)}}f.one=function(e,o,i){var r,a,f,l,h;if(e.DBG&&(e.DBG=h={DBG:e.DBG}),h&&(h.h=i),h&&(h.hp=+new Date),(r=e["#"])||(r=e["#"]=String.random(9)),!((f=u(r))||(a=e["##"])&&(f=e["@"]||e.get&&r)&&s.check(l=f+a))){if((e._=function(){}).via=n.leap=o,(f=e["><"])&&"string"==typeof f&&f.slice(0,99).split(",").forEach(function(t){this[t]=1},e._.yo={}),f=e.dam)return(f=n.hear[f])&&f(e,o,t),void c(r);i=+new Date,h&&(h.is=i),o.SI=r,t.on("in",n.last=e),h&&(h.hd=+new Date),console.STAT&&console.STAT(i,+new Date-i,e.get?"msg get":e.put?"msg put":"msg"),(f=c(r)).via=o,e.get&&(f.it=e),l&&c(l),n.leap=n.last=null}},f.c=f.d=0,function(){var t,r=0;function f(t,n){var e;return n instanceof Object?(Object.keys(n).sort().forEach(p,{to:e={},on:n}),e):n}function p(t){this.to[t]=this.on[t]}n.hash=function(t,n){var e,o,r,s=+new Date;a(t.put,function a(u,c){var f=(o||(o=r=c||"")).slice(0,32768);e=String.hash(f,e),(o=o.slice(32768))?i(a,0):(console.STAT&&console.STAT(s,+new Date-s,"say json+hash"),t._.$put=r,t["##"]=e,d(t,n),delete t._.$put)},f)};var d=n.say=function(a,u){var f;if((f=this)&&(f=f.to)&&f.next&&f.next(a),!a)return!1;var p,g,v=a["@"],y=a._||(a._=function(){}),k=a.DBG,m=+new Date;if(y.y=y.y||m,u||k&&(k.y=m),(p=a["#"])||(p=a["#"]=String.random(9)),!t&&c(p),a.put&&(a.err||(s.s[p]||"").err))return!1;if(a["##"]||e===a.put||y.via||!v){if(!u&&v&&(u=(f=s.s[v])&&(f.via||(f=f.it)&&(f=f._)&&f.via)||(f=n.last)&&v===f["#"]&&n.leap),!u&&v){if(s.s[v])return;return console.STAT&&console.STAT(+new Date,++r,"total no peer to ack to"),!1}if(!u&&n.way)return n.way(a);if(k&&(k.yh=+new Date),g=y.raw){if(k&&(k.yr=+new Date),!u||!u.id){if(!Object.plain(u||o.peers))return!1;m=+new Date,o.puff;var b=o.peers,_=Object.keys(u||o.peers||{});return console.STAT&&console.STAT(m,+new Date-m,"peer keys"),void function n(){var e=+new Date;t=1;var o=y.raw;y.raw=g;for(var r,s=0;s<9&&(r=(_||"")[s++]);)(r=b[r])&&d(a,r);y.raw=o,t=0,_=_.slice(s),console.STAT&&console.STAT(e,+new Date-e,"say loop"),_.length&&(i(n,0),v&&c(v))}()}if(!u.wire&&n.wire&&n.wire(u),p!==u.last){if(u.last=p,u===y.via)return!1;if((f=y.yo)&&(f[u.url]||f[u.pid]||f[u.id]))return!1;if(console.STAT&&console.STAT(m,((k||y).yp=+new Date)-(y.y||m),"say prep"),!t&&v&&c(v),u.batch){if(u.tail=(f=u.tail||0)+g.length,u.tail<=o.pack)return void(u.batch+=(f?",":"")+g);l(u)}u.batch="[";var $=+new Date;setTimeout(function(){console.STAT&&console.STAT($,+new Date-$,"0ms TO"),l(u)},o.gap),h(g,u),console.STAT&&v===u.SI&&console.STAT(m,+new Date-u.SH,"say ack")}}else n.raw(a,u)}else n.hash(a,u)};n.say.c=n.say.d=0,n.raw=function(t,i){if(!t)return"";var r,c,f=t._||{};if(c=f.raw)return c;if("string"==typeof t)return t;var l=t["##"],h=t["@"];if(l&&h){if(!f.via&&u(h+l))return!1;if((c=(s.s[h]||"").it)||(c=n.last)&&h===c["#"]){if(l===c["##"])return!1;c["##"]||(c["##"]=l)}}if(!t.dam){var p=0,g=[];for(var v in c=o.peers){var y=c[v];if(g.push(y.url||y.pid||y.id),++p>6)break}p>1&&(t["><"]=g.join())}if(r=f.$put)return c={},Object.keys(t).forEach(function(n){c[n]=t[n]}),c.put=":])([:",void a(c,function(t,n){if(!t){var o=+new Date;c=n.indexOf('"put":":])([:"'),k(e,n=n.slice(0,c+6)+r+n.slice(c+14)),console.STAT&&console.STAT(o,+new Date-o,"say slice")}});function k(n,e){n||(f.raw=e,d(t,i))}a(t,k)}}(),n.hi=function(e){var i=e.wire||{};e.id?o.peers[e.url||e.id]=e:(i=e.id=e.id||String.random(9),n.say({dam:"?",pid:t.opt.pid},o.peers[i]=e),delete s.s[e.last]),e.met=e.met||+new Date,i.hied||t.on(i.hied="hi",e),i=e.queue,e.queue=[],setTimeout.each(i||[],function(t){h(t,e)},0,9)},n.bye=function(e){t.on("bye",e);var o=+new Date;o-=e.met||o,n.bye.time=((n.bye.time||o)+o)/2},n.hear["!"]=function(t,n){o.log("Error:",t.err)},n.hear["?"]=function(t,e){t.pid&&(e.pid||(e.pid=t.pid),t["@"])||(n.say({dam:"?",pid:o.pid,"@":t["#"]},e),delete s.s[e.last])},t.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",n.say)}),t.on("bye",function(t,n){t=o.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),delete o.peers[t.id],t.wire=null});var p={};return t.on("bye",function(t,n){this.to.next(t),(n=console.STAT)&&(n.peers=(n.peers||0)-1),(n=t.url)&&(p[n]=!0,setTimeout(function(){delete p[n]},o.lack||9e3))}),t.on("hi",function(e,i){this.to.next(e),(i=console.STAT)&&(i.peers=(i.peers||0)+1),(i=e.url)&&p[i]&&(delete p[i],o.super||setTimeout.each(Object.keys(t.next),function(o){t.next[o],(i={})[o]=t.graph[o],i=String.hash(i),n.say({"##":i,get:{"#":o}},e)}))}),n}}catch(t){}})(t,"./mesh"),t(function(n){var e=t("../index");e.Mesh=t("./mesh"),e.on("opt",function(t){if(this.to.next(t),!t.once){var n=t.opt;if(!1!==n.WebSocket){var o=e.window||{},i=n.WebSocket||o.WebSocket||o.webkitWebSocket||o.mozWebSocket;if(i){n.WebSocket=i;var r=n.mesh=n.mesh||e.Mesh(t);r.wire||n.wire;r.wire=n.wire=u,setTimeout(function(){!n.super&&t.on("out",{dam:"hi"})},1);var a=1998,s=""+void 0!=typeof document&&document}}}function u(t){try{if(!t||!t.url)return o&&o(t);var e=t.url.replace(/^http/,"ws"),o=t.wire=new n.WebSocket(e);return o.onclose=function(){n.mesh.bye(t),c(t)},o.onerror=function(n){c(t)},o.onopen=function(){n.mesh.hi(t)},o.onmessage=function(e){e&&n.mesh.hear(e.data||e,t)},o}catch(t){}}function c(t){clearTimeout(t.defer),s&&t.retry<=0||(t.retry=(t.retry||n.retry+1||60)-(-t.tried+(t.tried=+new Date)<4*a?1:0),t.defer=setTimeout(function n(){if(s&&s.hidden)return setTimeout(n,a);u(t)},a))}})})(t,"./websocket"),t(function(t){if("undefined"!=typeof Gun){var n;try{n=(Gun.window||function(){}).localStorage}catch(t){}n||(Gun.log("Warning: No localStorage exists to persist data to!"),n={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}}),Gun.on("create",function t(e){this.to.next(e);var o,i,r=e.opt,a=(e.graph,[]);if(!1!==r.localStorage){r.prefix=r.file||"gun/";try{o=t[r.prefix]=t[r.prefix]||JSON.parse(n.getItem(r.prefix))||{}}catch(n){o=t[r.prefix]={}}e.on("get",function(t){this.to.next(t);var n,e,i,r=t.get;r&&(n=r["#"])&&((e=o[n]||void 0)&&(i=r["."])&&!Object.plain(i)&&(e=Gun.state.ify({},i,Gun.state.is(e,i),e[i],n)),Gun.on.get.ack(t,e))}),e.on("put",function(t){this.to.next(t);var n=t.put,e=n["#"],u=n["."];o[e]=Gun.state.ify(o[e],u,n[">"],n[":"],e),t["@"]||a.push(t["#"]),i||(i=setTimeout(s,r.wait||1))})}function s(){var t,s=a;clearTimeout(i),i=!1,a=[];try{n.setItem(r.prefix,JSON.stringify(o))}catch(n){Gun.log((t=n||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),e.on("localStorage:error",{err:t,get:r.prefix,put:o})}(t||Object.empty(r.peers))&&setTimeout.each(s,function(n){e.on("in",{"@":n,err:t,ok:0})})}})}})(t,"./localStorage")}(),function(){if(""+$!=typeof Gun){var t=function(t){console.log("Warning! Deprecated internal utility will break in next version:",t)},n=Gun;n.fn=n.fn||{is:function(n){return t("fn"),!!n&&"function"==typeof n}},n.bi=n.bi||{is:function(n){return t("bi"),n instanceof Boolean||"boolean"==typeof n}},n.num=n.num||{is:function(n){return t("num"),!o(n)&&(n-parseFloat(n)+1>=0||1/0===n||-1/0===n)}},n.text=n.text||{is:function(n){return t("text"),"string"==typeof n}},n.text.ify=n.text.ify||function(e){return t("text.ify"),n.text.is(e)?e:"undefined"!=typeof JSON?JSON.stringify(e):e&&e.toString?e.toString():e},n.text.random=n.text.random||function(n,e){t("text.random");var o="";for(n=n||24,e=e||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";n>0;)o+=e.charAt(Math.floor(Math.random()*e.length)),n--;return o},n.text.match=n.text.match||function(n,e){var o,i;return t("text.match"),"string"==typeof n&&("string"==typeof e&&(e={"=":e}),n===(o=(e=e||{})["="]||e["*"]||e[">"]||e["<"])||i===e["="]&&(o=e["*"]||e[">"]||e["<"],n.slice(0,(o||"").length)===o||i===e["*"]&&(i!==e[">"]&&i!==e["<"]?n>=e[">"]&&n<=e["<"]:i!==e[">"]&&n>=e[">"]||i!==e["<"]&&n<=e["<"])))},n.text.hash=n.text.hash||function(n,e){if(t("text.hash"),"string"==typeof n){if(e=e||0,!n.length)return e;for(var o=0,i=n.length;o<i;++o)e=(e<<5)-e+n.charCodeAt(o),e|=0;return e}},n.list=n.list||{is:function(n){return t("list"),n instanceof Array}},n.list.slit=n.list.slit||Array.prototype.slice,n.list.sort=n.list.sort||function(n){return t("list.sort"),function(t,e){return t&&e?(t=t[n])<(e=e[n])?-1:t>e?1:0:0}},n.list.map=n.list.map||function(n,e,o){return t("list.map"),a(n,e,o)},n.list.index=1,n.obj=n.boj||{is:function(n){return t("obj"),!!n&&(n instanceof Object&&n.constructor===Object||"Object"===Object.prototype.toString.call(n).match(/^\[object (\w+)\]$/)[1])}},n.obj.put=n.obj.put||function(n,e,o){return t("obj.put"),(n||{})[e]=o,n},n.obj.has=n.obj.has||function(n,e){return t("obj.has"),n&&Object.prototype.hasOwnProperty.call(n,e)},n.obj.del=n.obj.del||function(n,e){if(t("obj.del"),n)return n[e]=null,delete n[e],n},n.obj.as=n.obj.as||function(n,e,o,i){return t("obj.as"),n[e]=n[e]||(i===o?{}:o)},n.obj.ify=n.obj.ify||function(n){if(t("obj.ify"),i(n))return n;try{n=JSON.parse(n)}catch(t){n={}}return n},function(){var e;function o(t,n){r(this,n)&&e!==this[n]||(this[n]=t)}n.obj.to=n.obj.to||function(n,e){return t("obj.to"),a(n,o,e=e||{}),e}}(),n.obj.copy=n.obj.copy||function(n){return t("obj.copy"),n?JSON.parse(JSON.stringify(n)):n},function(){function e(t,n){var e=this.n;if(!e||!(n===e||i(e)&&r(e,n)))return void 0!==n||void 0}n.obj.empty=n.obj.empty||function(n,o){return t("obj.empty"),!n||!a(n,e,{n:o})}}(),function(){function e(t,n){if(2===arguments.length)return e.r=e.r||{},void(e.r[t]=n);e.r=e.r||[],e.r.push(t)}var a,s=Object.keys;Object.keys=Object.keys||function(t){return a(t,function(t,n,e){e(n)})},n.obj.map=a=n.obj.map||function(a,u,c){t("obj.map");var f,l,h,p,d,g=0,v="function"==typeof u;if(e.r=f,s&&i(a)&&(p=s(a),d=!0),c=c||{},o(a)||p)for(l=(p||a).length;g<l;g++){var y=g+n.list.index;if(v){if((h=d?u.call(c,a[p[g]],p[g],e):u.call(c,a[g],y,e))!==f)return h}else if(u===a[d?p[g]:g])return p?p[g]:y}else for(g in a)if(v){if(r(a,g)&&(h=c?u.call(c,a[g],g,e):u(a[g],g,e))!==f)return h}else if(u===a[g])return g;return v?e.r:n.list.index?0:-1}}(),n.time=n.time||{},n.time.is=n.time.is||function(n){return t("time"),n?n instanceof Date:+(new Date).getTime()};var e=n.fn.is,o=n.list.is,i=(_=n.obj).is,r=_.has,a=_.map,s={is:function(n){return t("val.is"),n!==$&&(null===n||n!==1/0&&(!!(l(n)||c(n)||f(n))||(s.link.is(n)||!1)))}};s.link=s.rel={_:"#"},function(){function n(t,n){var e=this;return e.id?e.id=!1:n==u&&l(t)?void(e.id=t):e.id=!1}s.link.is=function(e){if(t("val.link.is"),e&&e[u]&&!e._&&i(e)){var o={};if(a(e,n,o),o.id)return o.id}return!1}}(),s.link.ify=function(n){return t("val.link.ify"),h({},u,n)},n.obj.has._=".";var u=s.link._,c=n.bi.is,f=n.num.is,l=n.text.is,h=(i=(_=n.obj).is,_.put);a=_.map;n.val=n.val||s;var p={_:"_",soul:function(n,e){return t("node.soul"),n&&n._&&n._[e||v]}};p.soul.ify=function(n,e){return t("node.soul.ify"),e="string"==typeof e?{soul:e}:e||{},(n=n||{})._=n._||{},n._[v]=e.soul||n._[v]||g(),n},p.soul._=s.link._,function(){function n(t,n){if(n!==p._)return!s.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}p.is=function(e,o,r){var s;return t("node.is"),!!i(e)&&(!!(s=p.soul(e))&&!a(e,n,{as:r,cb:o,s:s,n:e}))}}(),function(){function n(t,n){var e,o=this.o;o.map?void 0===(e=o.map.call(this.as,t,""+n,o.node))?d(o.node,n):o.node&&(o.node[n]=e):s.is(t)&&(o.node[n]=t)}p.ify=function(e,o,i){return t("node.ify"),o?"string"==typeof o?o={soul:o}:"function"==typeof o&&(o={map:o}):o={},o.map&&(o.node=o.map.call(i,e,$,o.node||{})),(o.node=p.soul.ify(o.node||{},o))&&a(e,n,{o:o,as:i}),o.node}}();i=(_=n.obj).is;var d=_.del,g=(a=_.map,n.text.random),v=p.soul._;n.node=n.node||p;var y=n.state;y.lex=function(){return t("state.lex"),y().toString(36).replace(".","")},y.to=function(n,e,o){t("state.to");var r=(n||{})[e];return i(r)&&(r=k(r)),y.ify(o,e,y.is(n,e),r,p.soul(n))},function(){function n(t,n){m!==n&&y.ify(this.o,n,this.s)}y.map=function(o,s,u){var c;t("state.map");var l=i(l=o||s)?l:null;return o=e(o=o||s)?o:null,l&&!o?(s=f(s)?s:y(),l[m]=l[m]||{},a(l,n,{o:l,s:s}),l):(u=u||i(s)?s:c,s=f(s)?s:y(),function(t,e,i,a){if(!o)return n.call({o:i,s:s},t,e),t;o.call(u||this||{},t,e,i,a),r(i,e)&&c===i[e]||n.call({o:i,s:s},t,e)})}}();(_=n.obj).as,r=_.has,i=_.is,a=_.map;var k=_.copy,m=(f=n.num.is,e=n.fn.is,p._),b={};!function(){function n(t,n){if(!t||n!==p.soul(t)||!p.is(t,this.fn,this.as))return!0;this.cb&&(e.n=t,e.as=this.as,this.cb.call(e.as,t,n,e))}function e(t){t&&p.is(e.n,t,e.as)}b.is=function(e,o,r,s){return t("graph.is"),!(!e||!i(e)||w(e))&&!a(e,n,{cb:o,fn:r,as:s})}}(),function(){function e(t,n){var e;return(e=function(t,n){var e,o=t.seen,i=o.length;for(;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)}(t,n))?e:(n.env=t,n.soul=a,p.ify(n.obj,o,n)&&(n.link=n.link||s.link.ify(p.soul(n.node)),n.obj!==t.shell&&(t.graph[s.link.is(n.link)]=n.node)),n)}function o(t,n,o){var i,a,c=this,f=c.env;if(p._===n&&r(t,s.link._))return o._;if(i=u(t,n,o,c,f)){if(n||(c.node=c.node||o||{},r(t,p._)&&p.soul(t)&&(c.node._=k(t._)),c.node=p.soul.ify(c.node,s.link.is(c.link)),c.link=c.link||s.link.ify(p.soul(c.node))),(a=f.map)&&(a.call(f.as||{},t,n,o,c),r(o,n))){if(t=o[n],$===t)return void d(o,n);if(!(i=u(t,n,o,c,f)))return}if(!n)return c.node;if(!0===i)return t;if((a=e(f,{obj:t,path:c.path.concat(n)})).node)return a.link}}function a(t){var n=this,e=s.link.is(n.link),o=n.env.graph;n.link=n.link||s.link.ify(t),n.link[s.link._]=t,n.node&&n.node[p._]&&(n.node[p._][s.link._]=t),r(o,e)&&(o[t]=o[e],d(o,e))}function u(t,e,o,r,a){var c;return!!s.is(t)||(i(t)?1:(c=a.invalid)?u(t=c.call(a.as||{},t,e,o),e,o,r,a):(a.err="Invalid value at '"+r.path.concat(e).join(".")+"'!",void(n.list.is(t)&&(a.err+=" Use `.set(item)` instead of an Array."))))}b.ify=function(n,o,i){t("graph.ify");var r={path:[],obj:n};return o?"string"==typeof o?o={soul:o}:"function"==typeof o&&(o.map=o):o={},"string"==typeof i&&(o.soul=o.soul||i,i=$),o.soul&&(r.link=s.link.ify(o.soul)),o.shell=(i||{}).shell,o.graph=o.graph||{},o.seen=o.seen||[],o.as=o.as||i,e(o,r),o.root=r.node,o.graph}}(),b.node=function(n){t("graph.node");var e=p.soul(n);if(e)return h({},e,n)},function(){function n(t,n){var e,o;if(p._!==n)(e=s.link.is(t))?(o=this.opt.seen[e])?this.obj[n]=o:this.obj[n]=this.opt.seen[e]=b.to(this.graph,e,this.opt):this.obj[n]=t;else{if(w(t,s.link._))return;this.obj[n]=k(t)}}b.to=function(e,o,i){if(t("graph.to"),e){var r={};return i=i||{seen:{}},a(e[o],n,{obj:r,graph:e,opt:i}),r}}}();e=n.fn.is,i=(_=n.obj).is,d=_.del,r=_.has;var _,$,w=_.empty;h=_.put,a=_.map,k=_.copy;n.graph=n.graph||b}}();
